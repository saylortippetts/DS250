{
  "hash": "22404a15f86eb38036774850d927b359",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Client Report - Late Flights & Missing Data (JSON)\"\nsubtitle: \"Course DS 250\"\nauthor: \"[STUDENT NAME]\"\nformat:\n  html:\n    self-contained: true\n    page-layout: full\n    title-block-banner: true\n    toc: true\n    toc-depth: 3\n    toc-location: body\n    number-sections: false\n    html-math-method: katex\n    code-fold: true\n    code-summary: \"Show the code\"\n    code-overflow: wrap\n    code-copy: hover\n    code-tools:\n        source: false\n        toggle: true\n        caption: See code\nexecute: \n  warning: false\n    \n---\n\n::: {#d57bb9c1 .cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nimport numpy as np\nfrom lets_plot import *\n\nLetsPlot.setup_html(isolated_frame=True)\n```\n:::\n\n\n::: {#e0612915 .cell execution_count=2}\n``` {.python .cell-code}\n# Learn morea about Code Cells: https://quarto.org/docs/reference/cells/cells-jupyter.html\n\n# Include and execute your code here\ndf = pd.read_json(\"https://github.com/byuidatascience/data4missing/raw/master/data-raw/flights_missing/flights_missing.json\")\n```\n:::\n\n\n## Elevator pitch\n_A SHORT (2-3 SENTENCES) PARAGRAPH THAT `DESCRIBES KEY INSIGHTS` TAKEN FROM METRICS IN THE PROJECT RESULTS THINK TOP OR MOST IMPORTANT RESULTS._ (Note: this is not a summary of the project, but a summary of the results.)\n\n_From this summary we can learn that November is the best time to travel. We can also learn that SLC has the least amount of delays by weather._\n\n## QUESTION|TASK 1\n\n__Fix all of the varied missing data types in the data to be consistent (all missing values should be displayed as “NaN”).__ In your report include one record example (one row) from your new data, in the raw JSON format. Your example should display the \"NaN\" for at least one missing value.__  \n\n_In this question, I did a simple filtering and relpacement in order to cleanly show \"NaN\" using df.replace._\n\n::: {#5d43441e .cell execution_count=3}\n``` {.python .cell-code}\nmissing_tokens = [\"\", \" \", \"NA\", \"N/A\", \"null\", None]\ndf.replace(missing_tokens, np.nan, inplace=True)\n\nfor col in df.columns:\n    if \"num_of_\" in col or \"minutes_delayed\" in col:\n        df[col] = pd.to_numeric(df[col], errors=\"coerce\")\n\ndf[\"month\"] = df[\"month\"].replace({\"Febuary\": \"February\"})\n\none_row_json = (\n    df.sample(1)\n      .replace({np.nan: \"NaN\"})\n      .to_json(orient=\"records\", indent=2)\n)\n\none_row_json\n\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```\n'[\\n  {\\n    \"airport_code\":\"SAN\",\\n    \"airport_name\":\"NaN\",\\n    \"month\":\"April\",\\n    \"year\":2009.0,\\n    \"num_of_flights_total\":6824,\\n    \"num_of_delays_carrier\":329.0,\\n    \"num_of_delays_late_aircraft\":484,\\n    \"num_of_delays_nas\":231,\\n    \"num_of_delays_security\":4,\\n    \"num_of_delays_weather\":26,\\n    \"num_of_delays_total\":1074,\\n    \"minutes_delayed_carrier\":15089.0,\\n    \"minutes_delayed_late_aircraft\":25543,\\n    \"minutes_delayed_nas\":7792.0,\\n    \"minutes_delayed_security\":126,\\n    \"minutes_delayed_weather\":2039,\\n    \"minutes_delayed_total\":50589\\n  }\\n]'\n```\n:::\n:::\n\n\n## QUESTION|TASK 2\n\n__Which airport has the worst delays?__ Describe the metric you chose, and why you chose it to determine the “worst” airport. Your answer should include a summary table that lists (for each airport) the total number of flights, total number of delayed flights, proportion of delayed flights, and average delay time in hours.   \n\n_For this table, I decided to look into the avgerage delay hours by airport to be able to easily see which airport was doing the worst. I used lambda to do this._\n\n::: {#e0aec608 .cell execution_count=4}\n``` {.python .cell-code}\nsummary = (\n    df.groupby(\"airport_code\", dropna=True)\n      .agg(\n          total_flights   = (\"num_of_flights_total\", \"sum\"),\n          avg_delay_mins  = (\"minutes_delayed_total\", \"mean\")\n      )\n      .assign(\n          avg_delay_hrs = lambda d: d.avg_delay_mins / 60\n      )\n      .drop(columns=\"avg_delay_mins\")\n      .sort_values(\"avg_delay_hrs\", ascending=False)\n)\n\nsummary.head()\n\n```\n\n::: {.cell-output .cell-output-display execution_count=4}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>total_flights</th>\n      <th>avg_delay_hrs</th>\n    </tr>\n    <tr>\n      <th>airport_code</th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>ORD</th>\n      <td>3597588</td>\n      <td>7115.672854</td>\n    </tr>\n    <tr>\n      <th>ATL</th>\n      <td>4430047</td>\n      <td>6816.152273</td>\n    </tr>\n    <tr>\n      <th>SFO</th>\n      <td>1630945</td>\n      <td>3352.334975</td>\n    </tr>\n    <tr>\n      <th>DEN</th>\n      <td>2513974</td>\n      <td>3178.457197</td>\n    </tr>\n    <tr>\n      <th>IAD</th>\n      <td>851571</td>\n      <td>1298.418939</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n## QUESTION|TASK 3\n\n__What is the best month to fly if you want to avoid delays of any length?__ Describe the metric you chose and why you chose it to calculate your answer. Include one chart to help support your answer, with the x-axis ordered by month. (To answer this question, you will need to remove any rows that are missing the `Month` variable.)  \n\n_I did he same type of averaging idea for this question, but I averaged by month. It can clearly be seen that the best month to go is in November, due to the low amount of delays comparatively._\n\n::: {#8aa76ad4 .cell execution_count=5}\n``` {.python .cell-code}\n# Drop rows with missing months\nmonth_df = df.dropna(subset=[\"month\"])\n\nmonth_tbl = (\n    month_df.groupby(\"month\")\n      .agg(avg_delay_mins=(\"minutes_delayed_total\", \"mean\"))\n      .reset_index()\n)\n\n\nmonth_order = [\n    \"January\", \"February\", \"March\", \"April\", \"May\", \"June\",\n    \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"\n]\n\nmonth_tbl[\"month\"] = pd.Categorical(month_tbl[\"month\"], categories=month_order, ordered=True)\nmonth_tbl[\"avg_delay_hrs\"] = month_tbl[\"avg_delay_mins\"] / 60\nmonth_tbl = month_tbl.sort_values(\"month\")\n\nfrom lets_plot import *\n\nggplot(month_tbl) + \\\n    geom_bar(aes(x=\"month\", y=\"avg_delay_hrs\"), stat=\"identity\", fill=\"#1f77b4\") + \\\n    ggtitle(\"Average Delay Time by Month (in Hours)\") + \\\n    xlab(\"Month\") + ylab(\"Avg Delay (Hours)\") + \\\n    theme(axis_text_x=element_text(angle=45, hjust=1)) + \\\n    ggsize(700, 350)\n\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<html lang=\"en\">\n   <head>\n       <meta charset=\"UTF-8\">\n       <style> html, body { margin: 0; padding: 0; } </style>\n       <script type=\"text/javascript\" data-lets-plot-script=\"library\" src=\"https://cdn.jsdelivr.net/gh/JetBrains/lets-plot@v4.6.2/js-package/distr/lets-plot.min.js\"></script>\n   </head>\n   <body>\n          <div id=\"0uIWRa\"></div>\n   <script type=\"text/javascript\" data-lets-plot-script=\"plot\">\n   \n   (function() {\n   // ----------\n   \n   const forceImmediateRender = false;\n   const responsive = false;\n   \n   let sizing = {\n       width_mode: \"MIN\",\n       height_mode: \"SCALED\",\n       width: null, \n       height: null \n   };\n   \n   const preferredWidth = document.body.dataset.letsPlotPreferredWidth;\n   if (preferredWidth !== undefined) {\n       sizing = {\n           width_mode: 'FIXED',\n           height_mode: 'SCALED',\n           width: parseFloat(preferredWidth)\n       };\n   }\n   \n   const containerDiv = document.getElementById(\"0uIWRa\");\n   let fig = null;\n   \n   function renderPlot() {\n       if (fig === null) {\n           const plotSpec = {\n\"data\":{\n\"month\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\",null],\n\"avg_delay_hrs\":[3687.823515981735,3235.516447368421,3507.5732394366196,2958.366666666667,3113.6312785388127,4519.722222222222,4429.752380952381,3757.0144444444445,2589.1466216216218,2837.6173160173157,2436.8616228070173,4297.092922374429,3298.180864197531]\n},\n\"mapping\":{\n},\n\"data_meta\":{\n\"series_annotations\":[{\n\"type\":\"str\",\n\"factor_levels\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\n\"column\":\"month\"\n},{\n\"type\":\"float\",\n\"column\":\"avg_delay_mins\"\n},{\n\"type\":\"float\",\n\"column\":\"avg_delay_hrs\"\n}]\n},\n\"ggtitle\":{\n\"text\":\"Average Delay Time by Month (in Hours)\"\n},\n\"guides\":{\n\"x\":{\n\"title\":\"Month\"\n},\n\"y\":{\n\"title\":\"Avg Delay (Hours)\"\n}\n},\n\"theme\":{\n\"axis_text_x\":{\n\"angle\":45.0,\n\"hjust\":1.0,\n\"blank\":false\n}\n},\n\"ggsize\":{\n\"width\":700.0,\n\"height\":350.0\n},\n\"kind\":\"plot\",\n\"scales\":[],\n\"layers\":[{\n\"geom\":\"bar\",\n\"stat\":\"identity\",\n\"mapping\":{\n\"x\":\"month\",\n\"y\":\"avg_delay_hrs\"\n},\n\"data_meta\":{\n\"series_annotations\":[{\n\"column\":\"month\",\n\"factor_levels\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"]\n}]\n},\n\"fill\":\"#1f77b4\",\n\"data\":{\n}\n}],\n\"metainfo_list\":[],\n\"spec_id\":\"1\"\n};\n           fig = LetsPlot.buildPlotFromProcessedSpecs(plotSpec, containerDiv, sizing);\n       } else {\n           fig.updateView({});\n       }\n   }\n   \n   const renderImmediately = \n       forceImmediateRender || (\n           sizing.width_mode === 'FIXED' && \n           (sizing.height_mode === 'FIXED' || sizing.height_mode === 'SCALED')\n       );\n   \n   if (renderImmediately) {\n       renderPlot();\n   }\n   \n   if (!renderImmediately || responsive) {\n       // Set up observer for initial sizing or continuous monitoring\n       var observer = new ResizeObserver(function(entries) {\n           for (let entry of entries) {\n               if (entry.contentBoxSize && \n                   entry.contentBoxSize[0].inlineSize > 0) {\n                   if (!responsive && observer) {\n                       observer.disconnect();\n                       observer = null;\n                   }\n                   renderPlot();\n                   if (!responsive) {\n                       break;\n                   }\n               }\n           }\n       });\n       \n       observer.observe(containerDiv);\n   }\n   \n   // ----------\n   })();\n   \n   </script>\n   </body>\n</html>\n```\n:::\n:::\n\n\n## QUESTION|TASK 4\n\nAccording to the BTS website, the “Weather” category only accounts for severe weather delays. Mild weather delays are not counted in the “Weather” category, but are actually included in both the “NAS” and “Late-Arriving Aircraft” categories. __Your job is to create a new column that calculates the total number of flights delayed by weather (both severe and mild).__ You will need to replace all the missing values in the Late Aircraft variable with the mean. Show your work by printing the first 5 rows of data in a table. Use these three rules for your calculations:  \n\n    a. 100% of delayed flights in the Weather category are due to weather  \n    a. 30% of all delayed flights in the Late-Arriving category are due to weather  \n    a. From April to August, 40% of delayed flights in the NAS category are due to weather. The rest of the months, the proportion rises to 65%    \n\n_This analysis is able to take a deeper look into possible different weather delays that are not just severe. From this, we can see that ATL has the most delays. _\n\n::: {#443f88b1 .cell execution_count=6}\n``` {.python .cell-code}\n# Include and execute your code here\n# Make sure values are numeric\nfor col in [\"num_of_delays_weather\", \"num_of_delays_late_aircraft\", \"num_of_delays_nas\"]:\n    df[col] = pd.to_numeric(df[col], errors=\"coerce\")\n\n# Fill missing late aircraft delays with column mean\ndf[\"num_of_delays_late_aircraft\"].fillna(df[\"num_of_delays_late_aircraft\"].mean(), inplace=True)\n\n```\n:::\n\n\n::: {#ddfde796 .cell execution_count=7}\n``` {.python .cell-code}\n# Include and execute your code here\n\ndef compute_weather(row):\n    weather = row[\"num_of_delays_weather\"] or 0\n    late_aircraft = 0.30 * row[\"num_of_delays_late_aircraft\"]\n    \n\n    spring_summer = [\"April\", \"May\", \"June\", \"July\", \"August\"]\n    nas_pct = 0.40 if row[\"month\"] in spring_summer else 0.65\n    nas = nas_pct * (row[\"num_of_delays_nas\"] or 0)\n    \n    return weather + late_aircraft + nas\n\ndf[\"weather_all\"] = df.apply(compute_weather, axis=1)\n```\n:::\n\n\n::: {#af222643 .cell execution_count=8}\n``` {.python .cell-code}\n# Include and execute your code here\ndf[[\n    \"airport_code\", \"month\",\n    \"num_of_delays_weather\", \"num_of_delays_late_aircraft\", \"num_of_delays_nas\",\n    \"weather_all\"\n]].head()\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>airport_code</th>\n      <th>month</th>\n      <th>num_of_delays_weather</th>\n      <th>num_of_delays_late_aircraft</th>\n      <th>num_of_delays_nas</th>\n      <th>weather_all</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>ATL</td>\n      <td>January</td>\n      <td>448</td>\n      <td>-999</td>\n      <td>4598</td>\n      <td>3137.00</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>DEN</td>\n      <td>January</td>\n      <td>233</td>\n      <td>928</td>\n      <td>935</td>\n      <td>1119.15</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>IAD</td>\n      <td>January</td>\n      <td>61</td>\n      <td>1058</td>\n      <td>895</td>\n      <td>960.15</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>ORD</td>\n      <td>January</td>\n      <td>306</td>\n      <td>2255</td>\n      <td>5415</td>\n      <td>4502.25</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>SAN</td>\n      <td>January</td>\n      <td>56</td>\n      <td>680</td>\n      <td>638</td>\n      <td>674.70</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n## QUESTION|TASK 5\n\n__Using the new weather variable calculated above, create a barplot showing the proportion of all flights that are delayed by weather at each airport. Describe what you learn from this graph.__  \n\n_SFO has the most delays from weather that are mild and severe._\n\n::: {#e2091d57 .cell execution_count=9}\n``` {.python .cell-code}\n# Include and execute your code here\ndf[\"weather_delay_prop\"] = df[\"weather_all\"] / df[\"num_of_flights_total\"]\n\nweather_by_airport = (\n    df.groupby(\"airport_code\", dropna=True)\n      .agg(prop_weather_delay=(\"weather_delay_prop\", \"mean\"))\n      .reset_index()\n      .sort_values(\"prop_weather_delay\", ascending=False)\n)\n\nfrom lets_plot import *\n\n(ggplot(weather_by_airport) +\n geom_bar(aes(x=\"airport_code\",\n              y=\"prop_weather_delay\"),\n          stat=\"identity\",\n          fill=\"#1f77b4\") +\n ggtitle(\"Proportion of Flights Delayed by Weather (Severe + Mild)\") +\n xlab(\"Airport\") + ylab(\"Proportion delayed\") +\n theme(axis_text_x=element_text(angle=45, hjust=1)) +\n ggsize(700, 400))\n\n```\n\n::: {.cell-output .cell-output-display execution_count=9}\n```{=html}\n<html lang=\"en\">\n   <head>\n       <meta charset=\"UTF-8\">\n       <style> html, body { margin: 0; padding: 0; } </style>\n       <script type=\"text/javascript\" data-lets-plot-script=\"library\" src=\"https://cdn.jsdelivr.net/gh/JetBrains/lets-plot@v4.6.2/js-package/distr/lets-plot.min.js\"></script>\n   </head>\n   <body>\n          <div id=\"hxEU5G\"></div>\n   <script type=\"text/javascript\" data-lets-plot-script=\"plot\">\n   \n   (function() {\n   // ----------\n   \n   const forceImmediateRender = false;\n   const responsive = false;\n   \n   let sizing = {\n       width_mode: \"MIN\",\n       height_mode: \"SCALED\",\n       width: null, \n       height: null \n   };\n   \n   const preferredWidth = document.body.dataset.letsPlotPreferredWidth;\n   if (preferredWidth !== undefined) {\n       sizing = {\n           width_mode: 'FIXED',\n           height_mode: 'SCALED',\n           width: parseFloat(preferredWidth)\n       };\n   }\n   \n   const containerDiv = document.getElementById(\"hxEU5G\");\n   let fig = null;\n   \n   function renderPlot() {\n       if (fig === null) {\n           const plotSpec = {\n\"data\":{\n\"airport_code\":[\"SFO\",\"ORD\",\"ATL\",\"DEN\",\"IAD\",\"SAN\",\"SLC\"],\n\"prop_weather_delay\":[0.09809578030768146,0.08481745771186738,0.06554004057997952,0.05931687116111677,0.058400767986533465,0.053160202852123625,0.04264990989749563]\n},\n\"mapping\":{\n},\n\"data_meta\":{\n\"series_annotations\":[{\n\"type\":\"str\",\n\"column\":\"airport_code\"\n},{\n\"type\":\"float\",\n\"column\":\"prop_weather_delay\"\n}]\n},\n\"ggtitle\":{\n\"text\":\"Proportion of Flights Delayed by Weather (Severe + Mild)\"\n},\n\"guides\":{\n\"x\":{\n\"title\":\"Airport\"\n},\n\"y\":{\n\"title\":\"Proportion delayed\"\n}\n},\n\"theme\":{\n\"axis_text_x\":{\n\"angle\":45.0,\n\"hjust\":1.0,\n\"blank\":false\n}\n},\n\"ggsize\":{\n\"width\":700.0,\n\"height\":400.0\n},\n\"kind\":\"plot\",\n\"scales\":[],\n\"layers\":[{\n\"geom\":\"bar\",\n\"stat\":\"identity\",\n\"mapping\":{\n\"x\":\"airport_code\",\n\"y\":\"prop_weather_delay\"\n},\n\"data_meta\":{\n},\n\"fill\":\"#1f77b4\",\n\"data\":{\n}\n}],\n\"metainfo_list\":[],\n\"spec_id\":\"2\"\n};\n           fig = LetsPlot.buildPlotFromProcessedSpecs(plotSpec, containerDiv, sizing);\n       } else {\n           fig.updateView({});\n       }\n   }\n   \n   const renderImmediately = \n       forceImmediateRender || (\n           sizing.width_mode === 'FIXED' && \n           (sizing.height_mode === 'FIXED' || sizing.height_mode === 'SCALED')\n       );\n   \n   if (renderImmediately) {\n       renderPlot();\n   }\n   \n   if (!renderImmediately || responsive) {\n       // Set up observer for initial sizing or continuous monitoring\n       var observer = new ResizeObserver(function(entries) {\n           for (let entry of entries) {\n               if (entry.contentBoxSize && \n                   entry.contentBoxSize[0].inlineSize > 0) {\n                   if (!responsive && observer) {\n                       observer.disconnect();\n                       observer = null;\n                   }\n                   renderPlot();\n                   if (!responsive) {\n                       break;\n                   }\n               }\n           }\n       });\n       \n       observer.observe(containerDiv);\n   }\n   \n   // ----------\n   })();\n   \n   </script>\n   </body>\n</html>\n```\n:::\n:::\n\n\n---\n\n\n## STRETCH QUESTION|TASK 1\n\n__Which delay is the worst delay?__ Create a similar analysis as above for Weahter Delay with: Carrier Delay and Security Delay. Compare the proportion of delay for each of the three categories in a Chart and a Table. Describe your results.\n\n_type your results and analysis here_\n\n::: {#3237131f .cell execution_count=10}\n``` {.python .cell-code}\n# Include and execute your code here\n\n```\n:::\n\n\n---\n\n",
    "supporting": [
      "P3_template_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}